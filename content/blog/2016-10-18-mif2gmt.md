+++
title = "MIF2GMT：将MIF转换为GMT可用的数据格式"
date = "2016-10-18"
categories = ["GMT工具"]
authors = ['韦进', '刘珠妹']
slug = "mif2gmt"
+++

<div class="alert alert-info" role="alert">                              
程序下载：
<a href="/datas/MIF2GMT.exe">MIF2GMT.exe</a>
源码：<a href="https://github.com/gmt-china/GMT_tools/tree/master/MIF2GMT">MIF2GMT</a>
</div>  

工作中经常用到的一些数据，如断层、国界、省界、居民点，很多是MapInfo的TAB、MIF等文件格式，不能在GMT中直接使用，需要经过转换方可使用。

MIF2GMT 是一个将 MIF 格式的数据转换为 GMT 可用的 XY 格式的文本数据的小工具。此工具用 C# 写成，在 Windows 平台下可直接使用。

## 工具使用

工具运行环境：Windows平台、.NET Framework 4.0 及以上。

数据要求：此工具只支持MIF格式的数据。若原数据为MIF格式，则可直接使用。若原数据为TAB格式，则需要在MapInfo或其他软件中导出为MIF文件。

下载软件后，直接运行 `MIT2GMT.exe`，选择一个或多个MIF文件，程序自动在该文件当前目录下生成同名XY文件。

## 原理

### MapInfo数据格式

MapInfo 数据存储在包括 `*.TAB`、`*.DAT`（二进制）、`*.MAP`（二进制）、`*.ID`（二进制）为一组的文件中。分别存储着属性表结构、属性数据、空间数据和索引数据。

MapInfo未公开其内部数据结构，我们只能用以MapInfo为基础平台的软件打开以上数据。对外数据交换由 `*.MIF` 和 `*.MID` 这一组文本文件完成。也就是说我们可以将 `*.TAB` 数据导出为 `*.MIF` 和 `*.MID`，并对这两个文件进行编辑和再处理。其中 `*.MIF` 保存着表结构和对象的空间信息（坐标、符号样式）、 `*.MID` 则按同样顺序保存对象的属性信息。

### 数据提取原理

`*.MIF` 文件包括文件头和数据区。由于我们关注的是表数据（尤其是坐标值），因此我们需要将 `*MIF` 中的数据部分提取出来。对于不同类型的表，数据的存储格式分别为：

#### 点

点数据格式：

    POINT x y
    <SYMBOL (shape, color, size)>

注： `<>` 表示可省略。

例如：

    ***文件头***省略***

    Point 69.136757 34.530907
        Symbol (41,8726016,10)
    Point 62.209999 34.459999
        Symbol (41,8726016,10)
    Point 65.5 31.6
        Symbol (41,8726016,10)

#### 线

线数据格式：

    PLINE <num>
    x1 y1
    x2 y2
    ...
        <PEN (width, pattern, color)>
        <SMOOTH>

例如：

    ***文件头***省略***

    Pline 5
    86.44583 43.54956
    86.48676 43.54472
    86.53923 43.56675
    86.59575 43.58853
    86.6591 43.6133
        Pen (2,2,16711680)
        Smooth
    Pline 17
    86.58673 43.57684
    86.67906 43.56702
    86.77592 43.55147
    ...

#### 面数据

面数据格式：

    REGION <num_region>
    num_points
    x1 y1
    x2 y2
    ...
        <PEN (width, pattern, color)>
        <BRUSH (pattern, forecolor, backcolor)>
        <CENTER x y>

注： `num_region` 指多边形的数量，`num_points`指每个多边形节点的数量。

例如：

    ***文件头***省略***
    ...
    Region  1
      5
    121.925263 25.446125
    121.927017 25.449965
    121.929497 25.452316
    121.935623 25.452707
    121.936172 25.450329
        Pen (1,2,8421504)
        Brush (2,16756991,16777215)
        Center 120.935652 23.647805
    Region  1
      15858
    109.278892 31.723522
    ...

以上是基本图形的简化格式，一般我们只需要知道这一个文件的节点坐标，简单的做法就是识别坐标数据，属性部分替换为 `>`，表示数据分段，最后输出文件。这也是 `MIF2GMT.exe` 所做的工作。

## 将来工作

了解了MIF及MID数据格式后，还可以做的工作包括：

- 提取其中某段数据；
- 提取坐标以及图形线型、颜色属性；
- 提取MIF文件中的坐标值，MID文件中的属性值（如名称等），合并为一个数据；
- 等等等等
